[Главная](../docs/main.md)

# PM
Перед тем как читать стоит разобраться что такое PM
* [`Схема`][pmscheme]
* [`Вводнаяа статья по теме`][pmenter]
* [`Пример реализации`][pmexist]

## Критика готовой реализации
Приведенная выше реализация может быть позаимствована в общих концепциях,
но имеет следующие проблемы с прямым заимствованим
* Свой жизненный цикл PM - основная проблема интеграции
* Нет четкого разделения для осуществления однонаправленной связности.
* Плохо решенная проблема two-way binding`a. Подразумевающая для каждого
вида виджетов свою реализацию

# Предложение к реализации
## Общее
### Потоки данных
В рамках архитектуры подразумвается организация двух направленных
потоков данных
* от view к presentor`у (view > screen model > presenter)
* от presentor`a ко view (presenter > screen model > view)
* не регламентирует связь презентора и модели(sic!)

### Направленность потока
Под направленностью потоков подразумевается то, что данные могут быть
отпралены определенном типом отправителей для определнного типа получателей.
Например, view могут посылать данные только для презентора и подписаться
на потокмогут только презенторы и никто больше, в том числе эта
возможность недоступна и для самих view.

### Relation
Механиз огранизации направленности потоков. Поразумевает, что у потока
есть отправитель и получатель. Соответственно, отправитель может быть
либо источником данных для одного потока, либо получателем этих данных
### Сущности

#### [`RelationEntity`][related]
Тип источника или получателя

#### [`Related`][related]
Конечный объект который будет источником или получателем. Возможно, стоит
объединить с RelationEntity

#### [`Relation`][related]
Направленный поток данных, кеширует последнее переданное значение

#### Action
Деиствие исходящее от пользователя. Симметрично State.

#### State
Изменение состояния исходящее из ui/бизнес-логики. Симетрично Action.

#### TwoWay(рабочее название)
Action и State в одной сущности. Реализует внутри себя механизм защиты
от зацикливания. Суть костыль. Но, без него бывает тяжко.

## Известные проблемы

### Null-нетерпимость
Реализация основанная на [`RxRely`][rxrelylib] не принимает null.
Правда, как и весь RxJava 2

### Two-way binding
Описание проблемы [`здесь`][pmexist]
Решение: использование TwoWay в котором будет реализована базовая защита
от зацикливания - не будет эмитится элемент, если он не изменился.
Но, это не дает 100% защиту от зацикливания, да ее и не может быть.

### Анимации, тосты и проч.
Проблема дергающихся анимаций и череды одинаковых тостов.

### Кастомные виджеты и ItemController`ы
Как связывать все то, что не является стандартными андройдовыми виджетами
и для чего Вортон не написал Rx [`расширений`][rxbindinglib]
Решение: стандартный реактивный интерфейс который нужно будет реализовать
разработчику кастомной вью. Под этот интерфейс пишется сахар в либе

### Должна быть поддержка множественных презенторов

### Должен быть реализован принцип UnidirectionalDataFlow
В целом, его должен поддерживать механизм Relation. Но, могут быть проблемы
в презенторе на стыке с моделью

### Подписка на вычислимые свойства. То есть например подписка на флаг, которой зависит от других полей - типа валидация
Стандартный метод в rx сompose().

### Вложенность
Например Изменяемый список внутри которого могут модифицироваться объекты.
Пока не решаемо
Решение: не делать так. Использовать immutable свойства и
плоские(неиерархичные/декомпозированные) структуры

### freezeOperator и обработка ошибок
Используется стандартный функционал Presenter.subscribe(), который уже
умеет это делать


[rxbindinglib]: https://github.com/JakeWharton/RxBinding
[rxrelylib]: https://github.com/JakeWharton/RxRelay
[pmexist]: https://habr.com/company/mobileup/blog/342850/
[pmenter]: https://habr.com/company/mobileup/blog/326962/
[pmscheme]: https://habrastorage.org/webt/rz/nb/rh/rznbrht-4vw_74h6wzrjrui8upk.png
[related]: src/main/java/ru/surfstudio/android/core/mvp/rx/domain/Relation.kt